<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>APK Share - Motion-Flow</title>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --color-dark: #0a0a12;
      --color-bg: #0f0f1a;
      --color-bg-light: #1a1a2e;
      --color-primary: #00bcd4;
      --color-accent: #00bcd4;
      --color-accent-alt: #f97316;
      --color-success: #10b981;
      --color-warning: #f59e0b;
      --color-error: #ef4444;
      --color-text: #e2e8f0;
      --color-text-muted: #94a3b8;
      --font-heading: 'Orbitron', sans-serif;
      --font-body: 'Inter', sans-serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: var(--font-body);
    }

    body {
      margin: 0;
      min-height: 100vh;
      background-color: var(--color-bg);
      color: var(--color-text);
      overflow-x: hidden;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 50%, rgba(0, 188, 212, 0.05) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(249, 115, 22, 0.05) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    /* Mobile Navbar */
    .mobile-navbar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 60px;
      background: rgba(15, 17, 30, 0.98);
      z-index: 1002;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0, 188, 212, 0.2);
    }

    .navbar-content {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .menu-btn {
      background: none;
      border: none;
      color: var(--color-accent);
      font-size: 1.8em;
      cursor: pointer;
      padding: 5px;
      transition: all 0.3s ease;
      z-index: 1003;
    }

    .menu-btn:hover {
      color: var(--color-accent-alt);
      transform: scale(1.1);
    }

    .logo {
      font-family: var(--font-heading);
      font-size: 1.4em;
      font-weight: 900;
      letter-spacing: 2px;
    }

    .logo .motion { color: #ffffff; }
    .logo .flow { 
      color: var(--color-accent);
      background: linear-gradient(135deg, var(--color-accent), var(--color-accent-alt));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 0;
      left: -320px;
      width: 300px;
      height: 100vh;
      background: rgba(15, 17, 30, 0.98);
      color: #fff;
      display: flex;
      flex-direction: column;
      z-index: 1001;
      box-shadow: 2px 0 20px rgba(0, 188, 212, 0.2);
      backdrop-filter: blur(10px);
      transition: left 0.3s cubic-bezier(.4,0,.2,1);
      overflow-y: auto;
    }

    .sidebar.active {
      left: 0;
    }

    .sidebar-header {
      padding: 80px 25px 30px;
      background: rgba(15, 17, 30, 0.95);
      border-bottom: 1px solid rgba(0, 188, 212, 0.2);
      text-align: center;
    }

    .sidebar-nav {
      padding: 25px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      flex: 1;
    }

    .nav-btn {
      background: rgba(255, 255, 255, 0.05);
      color: #fff;
      border: 1px solid rgba(0, 188, 212, 0.1);
      padding: 15px 18px;
      border-radius: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 15px;
      font-size: 0.95em;
      font-weight: 600;
      transition: all 0.3s ease;
      text-align: left;
      position: relative;
      width: 100%;
      text-decoration: none;
    }

    .nav-btn:hover {
      background: rgba(0, 188, 212, 0.1);
      border-color: rgba(0, 188, 212, 0.3);
      transform: translateX(5px);
      box-shadow: 0 0 20px rgba(0, 188, 212, 0.2);
    }

    .nav-btn.active {
      background: linear-gradient(135deg, rgba(0, 188, 212, 0.1), rgba(249, 115, 22, 0.1));
      border-color: rgba(0, 188, 212, 0.4);
    }

    .nav-btn i {
      color: var(--color-accent);
      font-size: 1.2em;
      width: 24px;
      text-align: center;
    }

    .notification-badge {
      background: linear-gradient(135deg, #ff4757, #ff3742);
      color: white;
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 10px;
      margin-left: auto;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      padding: 80px 20px 120px;
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* APK Header */
    .apk-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .apk-header h1 {
      font-family: var(--font-heading);
      font-size: 2.2em;
      background: linear-gradient(135deg, var(--color-accent), var(--color-accent-alt));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 10px;
      letter-spacing: 2px;
      text-shadow: 0 0 10px rgba(0, 188, 212, 0.3);
    }

    .apk-header p {
      color: var(--color-text-muted);
      font-size: 1em;
      opacity: 0.8;
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.5;
    }

    /* Admin Controls */
    .admin-controls {
      max-width: 800px;
      margin: 0 auto 40px;
      display: none;
    }

    .admin-panel {
      background: var(--color-bg-light);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0, 188, 212, 0.1);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }

    .admin-panel:hover {
      border-color: rgba(0, 188, 212, 0.2);
      box-shadow: 0 10px 40px rgba(0, 188, 212, 0.2);
    }

    .admin-panel h2 {
      color: var(--color-accent);
      margin-bottom: 20px;
      font-size: 1.4em;
      font-family: var(--font-heading);
    }

    .create-apk-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-group label {
      color: var(--color-text);
      font-weight: 600;
      font-size: 0.9em;
    }

    .form-group input,
    .form-group textarea {
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      color: var(--color-text);
      font-size: 1em;
      transition: all 0.3s ease;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--color-accent);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 3px rgba(0, 188, 212, 0.2);
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }

    .image-upload-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .image-preview {
      width: 200px;
      height: 200px;
      border: 2px dashed rgba(0, 188, 212, 0.3);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: rgba(255, 255, 255, 0.05);
    }

    .image-preview img {
      max-width: 100%;
      max-height: 100%;
      object-fit: cover;
    }

    .image-preview:empty::before {
      content: 'Image Preview';
      color: var(--color-text-muted);
      opacity: 0.5;
    }

    .publish-btn {
      background: linear-gradient(135deg, var(--color-accent), var(--color-accent-alt));
      color: white;
      border: none;
      padding: 14px 20px;
      border-radius: 10px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      align-self: flex-start;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .publish-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0, 188, 212, 0.3);
    }

    /* APK Grid */
    .apk-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 25px;
      max-width: 1400px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    @media (max-width: 768px) {
      .apk-container {
        grid-template-columns: 1fr;
        gap: 20px;
      }
    }

    .apk-card {
      background: var(--color-bg-light);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      overflow: hidden;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .apk-card:hover {
      transform: translateY(-8px);
      border-color: rgba(0, 188, 212, 0.3);
      box-shadow: 0 15px 40px rgba(0, 188, 212, 0.2);
    }

    .apk-img-wrapper {
      width: 100%;
      height: 200px;
      overflow: hidden;
      position: relative;
      background: rgba(10, 12, 25, 0.6);
    }

    .apk-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s ease;
    }

    .apk-card:hover .apk-img {
      transform: scale(1.05);
    }

    .apk-info {
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      flex: 1;
    }

    .apk-header-info {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
    }

    .apk-title h3 {
      font-size: 1.2em;
      color: var(--color-text);
      margin: 0;
      line-height: 1.3;
      word-break: break-word;
      font-weight: 600;
    }

    .apk-date {
      background: rgba(0, 188, 212, 0.15);
      color: var(--color-accent);
      padding: 6px 12px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.8em;
      white-space: nowrap;
      border: 1px solid rgba(0, 188, 212, 0.3);
    }

    .apk-description {
      color: var(--color-text-muted);
      line-height: 1.5;
      flex: 1;
    }

    .apk-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      font-size: 0.85em;
    }

    .apk-author {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--color-accent);
    }

    .admin-badge {
      background: linear-gradient(135deg, var(--color-error), #dc2626);
      color: white;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 0.7em;
      font-weight: 600;
    }

    /* Share link functionality */
    .share-link-container {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 0.85em;
    }

    .share-link {
      flex: 1;
      color: var(--color-text-muted);
      font-size: 0.8em;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .copy-link-btn {
      background: rgba(0, 188, 212, 0.15);
      color: var(--color-accent);
      border: 1px solid rgba(0, 188, 212, 0.3);
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 0.8em;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .copy-link-btn:hover {
      background: rgba(0, 188, 212, 0.25);
      transform: scale(1.05);
    }

    /* Download button */
    .download-btn {
      background: linear-gradient(135deg, var(--color-accent), var(--color-accent-alt));
      color: white;
      border: none;
      padding: 12px 16px;
      border-radius: 10px;
      font-size: 0.9em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      text-decoration: none;
      width: 100%;
      margin-top: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .download-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0, 188, 212, 0.3);
    }

    /* Comments Section */
    .comments-section {
      margin-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding-top: 20px;
      display: none;
    }

    .comments-title {
      color: var(--color-accent);
      margin-bottom: 15px;
      font-size: 1.1em;
      font-weight: 600;
    }

    .comment-form {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .comment-input {
      flex: 1;
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      color: var(--color-text);
      font-size: 0.9em;
      transition: all 0.3s ease;
    }

    .comment-input:focus {
      outline: none;
      border-color: var(--color-accent);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 3px rgba(0, 188, 212, 0.2);
    }

    .comment-submit-btn {
      background: linear-gradient(135deg, var(--color-accent), var(--color-accent-alt));
      color: white;
      border: none;
      padding: 12px 16px;
      border-radius: 10px;
      font-size: 0.9em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .comment-submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0, 188, 212, 0.3);
    }

    .comments-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
      max-height: 200px;
      overflow-y: auto;
    }

    .comment-item {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 15px;
    }

    .comment-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .comment-author {
      color: var(--color-accent);
      font-weight: 600;
      font-size: 0.9em;
    }

    .comment-date {
      color: var(--color-text-muted);
      font-size: 0.8em;
      opacity: 0.7;
    }

    .comment-text {
      color: var(--color-text);
      line-height: 1.5;
      font-size: 0.9em;
    }

    /* Sidebar Overlay */
    .sidebar-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      backdrop-filter: blur(5px);
    }

    .sidebar-overlay.active {
      display: block;
    }

    /* Bottom Navigation */
    .bottom-nav-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 10px 0;
      z-index: 990;
      background: rgba(10, 10, 18, 0.7);
      backdrop-filter: blur(25px) saturate(150%);
      -webkit-backdrop-filter: blur(25px) saturate(150%);
      border-top: 1px solid rgba(0, 188, 212, 0.3);
      box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.5), 0 -2px 10px rgba(0, 188, 212, 0.1);
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      color: var(--color-text-muted);
      font-size: 0.7rem;
      font-weight: 500;
      padding: 5px 10px;
      border-radius: 8px;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
    }

    .nav-item i {
      font-size: 1.2rem;
      margin-bottom: 2px;
      transition: color 0.3s;
    }

    .nav-item.active {
      color: var(--color-primary);
      transform: scale(1.05);
    }

    .nav-item.active i {
      color: var(--color-primary);
      text-shadow: 0 0 8px rgba(0, 188, 212, 0.8);
    }

    .nav-item:hover {
      color: var(--color-primary);
    }

    /* Simple Footer */
    .simple-footer {
      text-align: center;
      padding: 20px;
      color: var(--color-text-muted);
      font-size: 0.9em;
      margin-top: 50px;
      margin-bottom: 80px;
    }

    .simple-footer a {
      color: var(--color-accent);
      text-decoration: none;
      transition: all 0.3s ease;
    }

    .simple-footer a:hover {
      text-decoration: underline;
    }

    /* Loading Animation */
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 20px;
      text-align: center;
      grid-column: 1 / -1;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(0, 188, 212, 0.1);
      border-radius: 50%;
      border-top-color: var(--color-accent);
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    .loading-text {
      color: var(--color-text-muted);
      font-size: 1.1em;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Empty State */
    .empty-state {
      grid-column: 1 / -1;
      text-align: center;
      padding: 80px 20px;
      color: var(--color-text-muted);
    }

    .empty-icon {
      font-size: 4em;
      color: rgba(0, 188, 212, 0.3);
      margin-bottom: 20px;
    }

    .empty-state h3 {
      font-size: 1.5em;
      margin-bottom: 10px;
      color: var(--color-text);
    }

    .empty-state p {
      font-size: 1.1em;
      opacity: 0.8;
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(15, 17, 30, 0.95);
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      border: 1px solid rgba(0, 188, 212, 0.3);
      backdrop-filter: blur(10px);
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      z-index: 2001;
      display: none;
      align-items: center;
      gap: 10px;
      animation: slideUp 0.3s ease;
    }

    .toast.show {
      display: flex;
    }

    .toast.success {
      border-color: rgba(16, 185, 129, 0.3);
    }

    .toast.error {
      border-color: rgba(239, 68, 68, 0.3);
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    /* Toggle Comments Button */
    .toggle-comments-btn {
      background: rgba(255, 255, 255, 0.05);
      color: var(--color-text);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.85em;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      margin-top: 10px;
      width: 100%;
      justify-content: center;
    }

    .toggle-comments-btn:hover {
      background: rgba(0, 188, 212, 0.1);
      border-color: rgba(0, 188, 212, 0.3);
      color: var(--color-accent);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .main-content {
        padding: 70px 15px 100px;
      }
      
      .apk-header h1 {
        font-size: 1.8em;
      }
      
      .apk-container {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      .admin-panel {
        padding: 20px;
      }
      
      .image-preview {
        width: 150px;
        height: 150px;
      }
    }

    @media (max-width: 480px) {
      .main-content {
        padding: 70px 10px 90px;
      }
      
      .apk-info {
        padding: 15px;
      }
      
      .sidebar {
        width: 280px;
      }
      
      .sidebar-header {
        padding: 70px 20px 25px;
      }
      
      .sidebar-nav {
        padding: 20px;
      }
      
      .nav-btn {
        padding: 12px 15px;
        font-size: 0.9em;
      }
    }
  </style>
</head>
<body>
  <!-- Mobile Navbar -->
  <div class="mobile-navbar">
    <div class="navbar-content">
      <button class="menu-btn" id="openSidebar">â˜°</button>
      <div class="logo">
        <span class="motion">MOTION</span><span class="flow">FLOW</span>
      </div>
    </div>
  </div>
  
  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>
  
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="logo" style="font-size: 1.8em;">
        <span class="motion">MOTION</span><span class="flow">FLOW</span>
      </div>
    </div>
    <div class="sidebar-nav">
      <a href="homepage.html" class="nav-btn" id="homeBtn">
        <i class="fas fa-home"></i>
        Home
      </a>

      <a href="apk.html" class="nav-btn active" id="apkBtn">
        <i class="fas fa-download"></i>
        APK Share
      </a>

      <a href="Users/users.html" class="nav-btn" id="usersBtn">
        <i class="fas fa-users"></i>
        Users
      </a>

      <a href="Chats/chats.html" class="nav-btn" id="chatBtn">
        <i class="fas fa-comments"></i>
        Messages
        <span class="notification-badge" id="chatNotificationBadge" style="display: none;">0</span>
      </a>

      <!-- Admin Only Section -->
      <div id="adminSection" style="display: none;">
        <a href="Host/host.html" class="nav-btn" id="uploadBtn">
          <i class="fas fa-upload"></i>
          Upload Project
        </a>
      </div>

      <a href="Settings/settings.html" class="nav-btn" id="settingsBtn">
        <i class="fas fa-cog"></i>
        Settings
      </a>

      <button class="nav-btn" id="logOutBtn" style="margin-top: auto; background: rgba(229, 57, 53, 0.1); border-color: rgba(229, 57, 53, 0.3); color: #e53935;">
        <i class="fas fa-sign-out-alt"></i>
        Logout
      </button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content" id="mainContent">
    <!-- APK Header -->
    <div class="apk-header">
      <h1>APK Share Platform</h1>
      <p>Share and discover amazing Android applications with our community</p>
    </div>
    
    <!-- Admin Controls (Only visible to admins) -->
    <div class="admin-controls" id="adminControls">
      <div class="admin-panel">
        <h2><i class="fas fa-upload"></i> Share APK</h2>
        <div class="create-apk-form">
          <div class="form-group">
            <label for="apkTitle">APK Title</label>
            <input type="text" id="apkTitle" placeholder="Enter APK title...">
          </div>
          <div class="form-group">
            <label for="apkDescription">Description</label>
            <textarea id="apkDescription" placeholder="Enter APK description..."></textarea>
          </div>
          <div class="form-group">
            <label for="apkImage">Image (1:1 ratio recommended)</label>
            <div class="image-upload-container">
              <input type="file" id="apkImage" accept="image/*">
              <div class="image-preview" id="imagePreview"></div>
            </div>
          </div>
          <div class="form-group">
            <label for="apkDownloadLink">Download Link</label>
            <input type="url" id="apkDownloadLink" placeholder="https://example.com/file.apk">
          </div>
          <button class="publish-btn" id="publishApk">
            <i class="fas fa-paper-plane"></i> Publish APK
          </button>
        </div>
      </div>
    </div>
    
    <!-- APK Grid -->
    <div class="apk-container" id="apkContainer">
      <!-- APKs will be loaded here -->
    </div>
  </div>
  
  <!-- Simple Footer -->
  <footer class="simple-footer">
    <p>Made with <i class="fas fa-heart" style="color: #ef4444;"></i> by <a href="https://t.me/eclipsia_techs" target="_blank">eclipsia-techs</a></p>
  </footer>

  <!-- Bottom Navigation -->
  <footer class="bottom-nav-bar">
    <a href="../homepage.html" class="nav-item">
      <i class="fas fa-home"></i>
      <span>Home</span>
    </a>
    
    <a href="../updates/updates.html" class="nav-item">
      <i class="fas fa-bell"></i>
      <span>Updates</span>
    </a>
    
    <a href="../Live_Chat/live.html" class="nav-item">
      <i class="fas fa-comments"></i>
      <span>Live Chat</span>
    </a>
    
    <a href="../profile/profile.html" class="nav-item">
      <i class="fas fa-user"></i>
      <span>Profile</span>
    </a>
  </footer>

  <!-- Toast Notification -->
  <div class="toast" id="toast">
    <i class="fas fa-check-circle" id="toastIcon"></i>
    <span id="toastMessage">Copied to clipboard!</span>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { ref, set, getDatabase, push, onValue, get, update } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";
    import { onAuthStateChanged, getAuth, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

    // Use the SAME Firebase config as homepage.html
    const firebaseConfig = {
      apiKey: "AIzaSyCy5uQGcg1cALqFSa1xAQOL6lX8Gz5nFNU",
      authDomain: "motion-flow-47450.firebasestorage.app",
      databaseURL: "https://motion-flow-47450-default-rtdb.firebaseio.com",
      projectId: "motion-flow-47450",
      storageBucket: "motion-flow-47450.firebasestorage.app",
      messagingSenderId: "686875529848",
      appId: "1:686875529848:web:48edf5164aaaf938cdd38d",
      measurementId: "G-K46N8C1HFQ"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase();

    console.log('ðŸ”¥ APK Share Platform initialized');

    // DOM Elements
    const apkContainer = document.getElementById("apkContainer");
    const sidebar = document.getElementById('sidebar');
    const openSidebar = document.getElementById('openSidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    const adminControls = document.getElementById('adminControls');
    const publishApkBtn = document.getElementById('publishApk');
    const apkTitle = document.getElementById('apkTitle');
    const apkDescription = document.getElementById('apkDescription');
    const apkImage = document.getElementById('apkImage');
    const apkDownloadLink = document.getElementById('apkDownloadLink');
    const imagePreview = document.getElementById('imagePreview');
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toastMessage');
    const toastIcon = document.getElementById('toastIcon');

    // User state
    let currentUserId = null;
    let currentUserData = null;
    let sidebarOpen = false;
    let selectedImageFile = null;

    // Admin users (add your admin UIDs here)
    const adminUsers = [
      "YOUR_ADMIN_UID_HERE"
    ];

    // Example APKs data - 3 examples as requested
    const exampleApks = [
      {
        id: 'apk_1',
        title: 'Premium Video Player Pro',
        description: 'Advanced video player with support for all formats, background playback, subtitle support, and 4K streaming capability.',
        downloadLink: 'https://example.com/videoplayer-pro.apk',
        authorId: 'admin_001',
        authorName: 'Motion-Flow Team',
        createdAt: Date.now() - (2 * 24 * 60 * 60 * 1000), // 2 days ago
        image: 'https://images.unsplash.com/photo-1574375927938-d5a98e8ffe85?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80',
        type: 'apk',
        downloads: 156
      },
      {
        id: 'apk_2',
        title: 'Photo Editor Master',
        description: 'Professional photo editing app with AI-powered filters, effects, advanced editing tools, and batch processing.',
        downloadLink: 'https://example.com/photoeditor-master.apk',
        authorId: 'admin_002',
        authorName: 'Creative Studio',
        createdAt: Date.now() - (5 * 24 * 60 * 60 * 1000), // 5 days ago
        image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80',
        type: 'apk',
        downloads: 289
      },
      {
        id: 'apk_3',
        title: 'File Manager Plus Pro',
        description: 'Powerful file manager with cloud storage support, file compression, advanced search, and network sharing.',
        downloadLink: 'https://example.com/filemanager-pro.apk',
        authorId: 'admin_001',
        authorName: 'Motion-Flow Team',
        createdAt: Date.now() - (7 * 24 * 60 * 60 * 1000), // 7 days ago
        image: 'https://images.unsplash.com/photo-1611224923853-80b023f02d71?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80',
        type: 'apk',
        downloads: 187
      }
    ];

    // Toast notification function
    function showToast(message, type = 'success') {
      toastMessage.textContent = message;
      toast.className = `toast ${type}`;
      toastIcon.className = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
      
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Sidebar functionality
    function toggleSidebar() {
      sidebarOpen = !sidebarOpen;
      if (sidebarOpen) {
        sidebar.classList.add('active');
        sidebarOverlay.classList.add('active');
      } else {
        sidebar.classList.remove('active');
        sidebarOverlay.classList.remove('active');
      }
    }

    openSidebar.addEventListener('click', toggleSidebar);
    sidebarOverlay.addEventListener('click', toggleSidebar);

    // Logout functionality
    document.getElementById('logOutBtn').addEventListener("click", async () => {
      const confirmLogout = confirm("Are you sure you want to logout?");
      if (!confirmLogout) return;

      try {
        const user = auth.currentUser;
        if (user) {
          await update(ref(db, "users/" + user.uid), {
            status: "offline",
          });
        }
        await signOut(auth);
        window.location.href = "index.html";
      } catch (error) {
        console.error("Logout failed:", error);
        showToast("Something went wrong while logging out.", "error");
      }
    });

    // Image upload preview
    apkImage.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        selectedImageFile = file;
        const reader = new FileReader();
        reader.onload = function(e) {
          imagePreview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
        };
        reader.readAsDataURL(file);
      }
    });

    // Publish APK
    publishApkBtn.addEventListener('click', async function() {
      if (!apkTitle.value.trim() || !apkDescription.value.trim() || !apkDownloadLink.value.trim()) {
        showToast('Please fill in all fields', 'error');
        return;
      }

      if (!selectedImageFile) {
        showToast('Please select an image for the APK', 'error');
        return;
      }

      try {
        publishApkBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Publishing...';
        publishApkBtn.disabled = true;

        const apkId = 'apk_' + Date.now();
        const imageDataUrl = await readFileAsDataURL(selectedImageFile);
        
        const apkData = {
          id: apkId,
          title: apkTitle.value.trim(),
          description: apkDescription.value.trim(),
          downloadLink: apkDownloadLink.value.trim(),
          authorId: currentUserId,
          authorName: currentUserData?.username || 'Admin',
          createdAt: Date.now(),
          image: imageDataUrl,
          type: 'apk',
          downloads: 0
        };

        // Save to database
        await set(ref(db, `apks/${apkId}`), apkData);
        
        // Clear form
        apkTitle.value = '';
        apkDescription.value = '';
        apkImage.value = '';
        apkDownloadLink.value = '';
        imagePreview.innerHTML = '';
        selectedImageFile = null;
        
        showToast('APK published successfully!', 'success');
        
        // Reload APKs
        loadApksData();
        
      } catch (error) {
        console.error('Error publishing APK:', error);
        showToast('Failed to publish APK: ' + error.message, 'error');
      } finally {
        publishApkBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Publish APK';
        publishApkBtn.disabled = false;
      }
    });

    // Helper function to read file as data URL
    function readFileAsDataURL(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = function(e) {
          resolve(e.target.result);
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // Copy link function
    function copyApkLink(apkId) {
      const apkUrl = `${window.location.origin}${window.location.pathname}?apk=${apkId}`;
      navigator.clipboard.writeText(apkUrl).then(() => {
        showToast('APK link copied to clipboard!', 'success');
      }).catch(err => {
        console.error('Failed to copy link: ', err);
        showToast('Failed to copy link. Please try again.', 'error');
      });
    }

    // Auth state listener
    onAuthStateChanged(auth, (user) => {
      if (user) {
        currentUserId = user.uid;
        console.log('âœ… User logged in:', user.uid);
        
        // Load user data
        const userRef = ref(db, `users/${user.uid}`);
        onValue(userRef, (snapshot) => {
          if (snapshot.exists()) {
            currentUserData = snapshot.val();
            
            // Check if user is admin
            if (adminUsers.includes(user.uid)) {
              adminControls.style.display = 'block';
            }
          }
        });
        
        // Load APKs data
        loadApksData();
      } else {
        window.location.href = "index.html";
      }
    });

    // Loading animation
    function showLoadingAnimation() {
      apkContainer.innerHTML = `
        <div class="loading-container">
          <div class="loading-spinner"></div>
          <div class="loading-text">Loading APKs...</div>
        </div>
      `;
    }

    // APKs data loading - FIXED: Shows example APKs immediately without Firebase error
    function loadApksData() {
      showLoadingAnimation();
      
      // Try to load from Firebase first
      const apksRef = ref(db, "apks");
      
      onValue(apksRef, (snapshot) => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          const apks = Object.keys(data).map(key => ({
            ...data[key],
            id: key
          }));
          
          // Sort by creation date (newest first)
          apks.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
          
          console.log(`ðŸ“± Loaded ${apks.length} APKs from Firebase`);
          
          if (apks.length === 0) {
            showExampleApks();
          } else {
            renderApks(apks);
          }
        } else {
          // If no APKs in database, show example content
          console.log('ðŸ“± No APKs in Firebase database, showing example APKs');
          showExampleApks();
        }
      }, (error) => {
        console.log('ðŸ“± Firebase not available, showing example APKs:', error.message);
        showExampleApks();
      });
    }

    // Show example APKs
    function showExampleApks() {
      // Sort by creation date (newest first)
      const sortedExampleApks = [...exampleApks].sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
      console.log(`ðŸ“± Showing ${sortedExampleApks.length} example APKs`);
      renderApks(sortedExampleApks);
      
      // Show info message for non-admin users
      if (!adminUsers.includes(currentUserId)) {
        const infoMsg = document.createElement('div');
        infoMsg.className = 'empty-state';
        infoMsg.style.gridColumn = '1 / -1';
        infoMsg.style.marginTop = '20px';
        infoMsg.innerHTML = `
          <p style="color: var(--color-accent-alt); font-size: 0.9em; font-style: italic;">
            <i class="fas fa-info-circle"></i> These are example APKs. Admin users can publish real APKs.
          </p>
        `;
        apkContainer.appendChild(infoMsg);
      }
    }

    // Show empty state
    function showEmptyState() {
      apkContainer.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">
            <i class="fas fa-box-open"></i>
          </div>
          <h3>No APKs available</h3>
          <p>No APKs have been shared yet. Be the first to share one!</p>
          ${currentUserId && adminUsers.includes(currentUserId) ? 
            '<button class="download-btn" onclick="document.getElementById(\'adminControls\').scrollIntoView({behavior: \'smooth\'})" style="margin-top: 20px; width: auto;"><i class="fas fa-plus"></i> Share First APK</button>' : 
            ''
          }
        </div>
      `;
    }

    // Render APKs
    function renderApks(apks) {
      apkContainer.innerHTML = '';
      
      if (apks.length === 0) {
        showEmptyState();
        return;
      }
      
      apks.forEach(apk => {
        createApkCard(apk);
      });
    }

    function createApkCard(apk) {
      const card = document.createElement('div');
      card.className = 'apk-card';
      
      const isAdmin = adminUsers.includes(apk.authorId);
      const apkUrl = `${window.location.origin}${window.location.pathname}?apk=${apk.id}`;
      
      card.innerHTML = `
        <div class="apk-img-wrapper">
          <img src="${apk.image}" alt="${apk.title}" class="apk-img" onerror="this.src='https://via.placeholder.com/400x200/1a1a2e/00bcd4?text=APK+Image'">
        </div>
        
        <div class="apk-info">
          <div class="apk-header-info">
            <div class="apk-title">
              <h3>${apk.title}</h3>
            </div>
            <div class="apk-date">
              ${getTimeAgo(apk.createdAt || Date.now())}
            </div>
          </div>
          
          <div class="apk-description">
            ${apk.description}
          </div>
          
          <div class="share-link-container">
            <div class="share-link" title="${apkUrl}">
              <i class="fas fa-hashtag"></i> ${apk.id}
            </div>
            <button class="copy-link-btn" onclick="copyApkLink('${apk.id}')">
              <i class="fas fa-copy"></i> Copy Link
            </button>
          </div>
          
          <div class="apk-meta">
            <div class="apk-author">
              <i class="fas fa-user"></i> ${apk.authorName || 'Admin'}
              ${isAdmin ? '<span class="admin-badge">ADMIN</span>' : ''}
            </div>
            <div style="color: var(--color-text-muted);">
              <i class="fas fa-download"></i> ${apk.downloads || 0}
            </div>
          </div>
          
          <button class="download-btn" onclick="downloadApk('${apk.id}', '${apk.downloadLink}', '${apk.title}')">
            <i class="fas fa-download"></i> Download APK
          </button>
          
          <button class="toggle-comments-btn" onclick="toggleComments('${apk.id}')">
            <i class="fas fa-comments"></i> Show Comments
          </button>
          
          <div class="comments-section" id="comments-section-${apk.id}">
            <div class="comments-title">Comments</div>
            <div class="comment-form">
              <input type="text" class="comment-input" id="commentInput-${apk.id}" placeholder="Add a comment...">
              <button class="comment-submit-btn" onclick="addComment('${apk.id}')">
                <i class="fas fa-paper-plane"></i> Post
              </button>
            </div>
            <div class="comments-list" id="comments-${apk.id}">
              <!-- Comments will be loaded here -->
            </div>
          </div>
        </div>
      `;
      
      apkContainer.appendChild(card);
      
      // Load comments for this APK
      loadComments(apk.id);
    }

    // Utility functions
    function getTimeAgo(timestamp) {
      const now = Date.now();
      const diff = now - timestamp;
      const seconds = Math.floor(diff / 1000);
      const minutes = Math.floor(seconds / 60);
      const hours = Math.floor(minutes / 60);
      const days = Math.floor(hours / 24);
      
      if (days > 0) return `${days}d ago`;
      if (hours > 0) return `${hours}h ago`;
      if (minutes > 0) return `${minutes}m ago`;
      return 'Just now';
    }

    // Download APK function
    window.downloadApk = async function(apkId, downloadLink, apkTitle) {
      try {
        // If this is a real Firebase APK, increment download count
        if (apkId.startsWith('apk_') && !exampleApks.find(apk => apk.id === apkId)) {
          const downloadCountRef = ref(db, `apks/${apkId}/downloads`);
          const currentCount = await get(downloadCountRef);
          const newCount = (currentCount.val() || 0) + 1;
          await set(downloadCountRef, newCount);
        }
        
        // Open download link
        window.open(downloadLink, '_blank');
        showToast(`Downloading ${apkTitle}...`, 'success');
      } catch (error) {
        console.error('Error tracking download:', error);
        window.open(downloadLink, '_blank');
      }
    };

    // Toggle comments visibility
    window.toggleComments = function(apkId) {
      const commentsSection = document.getElementById(`comments-section-${apkId}`);
      const toggleBtn = commentsSection.previousElementSibling;
      
      if (commentsSection.style.display === 'block') {
        commentsSection.style.display = 'none';
        toggleBtn.innerHTML = '<i class="fas fa-comments"></i> Show Comments';
      } else {
        commentsSection.style.display = 'block';
        toggleBtn.innerHTML = '<i class="fas fa-times"></i> Hide Comments';
      }
    };

    // Load comments for an APK
    function loadComments(apkId) {
      const commentsList = document.getElementById(`comments-${apkId}`);
      
      // Only load comments for real Firebase APKs, not example ones
      if (exampleApks.find(apk => apk.id === apkId)) {
        commentsList.innerHTML = '<div style="color: var(--color-text-muted); text-align: center; padding: 20px; font-style: italic;">Comments are available for real APKs only</div>';
        return;
      }
      
      onValue(ref(db, `apks/${apkId}/comments`), (snapshot) => {
        if (snapshot.exists()) {
          const comments = snapshot.val();
          const commentsArray = Object.keys(comments).map(key => ({
            ...comments[key],
            id: key
          }));
          
          // Sort by creation date (newest first)
          commentsArray.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
          
          commentsList.innerHTML = '';
          commentsArray.forEach(comment => {
            const commentItem = document.createElement('div');
            commentItem.className = 'comment-item';
            commentItem.innerHTML = `
              <div class="comment-header">
                <div class="comment-author">${comment.authorName || 'Anonymous'}</div>
                <div class="comment-date">${getTimeAgo(comment.createdAt || Date.now())}</div>
              </div>
              <div class="comment-text">${comment.text}</div>
            `;
            commentsList.appendChild(commentItem);
          });
        } else {
          commentsList.innerHTML = '<div style="color: var(--color-text-muted); text-align: center; padding: 20px; font-style: italic;">No comments yet. Be the first to comment!</div>';
        }
      });
    }

    // Add a comment
    window.addComment = async function(apkId) {
      // Don't allow comments on example APKs
      if (exampleApks.find(apk => apk.id === apkId)) {
        showToast('Comments are not available for example APKs', 'error');
        return;
      }
      
      const commentInput = document.getElementById(`commentInput-${apkId}`);
      const commentText = commentInput.value.trim();
      
      if (!commentText) {
        showToast('Please enter a comment', 'error');
        return;
      }
      
      if (!currentUserId) {
        showToast('Please login to comment', 'error');
        return;
      }
      
      try {
        const commentId = 'comment_' + Date.now();
        const commentData = {
          id: commentId,
          text: commentText,
          authorId: currentUserId,
          authorName: currentUserData?.username || 'Anonymous',
          createdAt: Date.now()
        };
        
        await set(ref(db, `apks/${apkId}/comments/${commentId}`), commentData);
        commentInput.value = '';
        showToast('Comment added successfully!', 'success');
      } catch (error) {
        console.error('Error adding comment:', error);
        showToast('Failed to add comment: ' + error.message, 'error');
      }
    };

    // Make functions available globally
    window.copyApkLink = copyApkLink;
    window.loadApksData = loadApksData;

    // Handle escape key to close sidebar
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && sidebarOpen) {
        toggleSidebar();
      }
    });

    // Initialize on load
    document.addEventListener('DOMContentLoaded', () => {
      console.log('ðŸ“± APK Share page loaded');
      showLoadingAnimation();
      
      // Load example APKs immediately (will be replaced if Firebase has data)
      setTimeout(() => {
        showExampleApks();
      }, 500);
    });
  </script>
</body>
</html>